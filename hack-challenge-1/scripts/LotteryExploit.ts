import { Address, beginCell, toNano } from '@ton/core';
import { compile, NetworkProvider } from '@ton/blueprint';

import { Lottery } from '../wrappers/wrappers/Lottery';
import { LotteryExploit } from '../wrappers/wrappers/LotteryExploit';

// yarn blueprint run LotteryExploit --testnet --mnemonic
export async function run(provider: NetworkProvider) {
    const code = await compile('Lottery');
    const exploit = await compile('LotteryExploit');

    const lottery = provider.open(Lottery.createFromConfig({}, code));
    await lottery.sendDeploy(provider.sender(), toNano('1'));
    await provider.waitForDeploy(lottery.address);

    const lotteryExploit = provider.open(LotteryExploit.createFromConfig({}, exploit));
    await lotteryExploit.sendDeploy(provider.sender(), toNano('10'));
    await provider.waitForDeploy(lotteryExploit.address);

    console.log(lotteryExploit.address);

    await lotteryExploit.sendExternal(beginCell().endCell());
}
